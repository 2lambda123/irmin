<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>S (irmin-pack.Irmin_pack_unix.Dispatcher.S)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">irmin-pack</a> &#x00BB; <a href="../../index.html">Irmin_pack_unix</a> &#x00BB; <a href="../index.html">Dispatcher</a> &#x00BB; S</nav><header class="odoc-preamble"><h1>Module type <code><span>Dispatcher.S</span></code></h1></header><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Fm"><a href="#module-Fm" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Fm/index.html">Fm</a></span><span> : <a href="../../File_manager/module-type-S/index.html">File_manager.S</a></span></code></div><div class="spec-doc"><p>Abstraction that governs the lifetime of the various files that are part of a pack store (except the branch store).</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Mapping_file"><a href="#module-Mapping_file" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Mapping_file/index.html">Mapping_file</a></span><span> : <a href="../../Mapping_file/module-type-S/index.html">Mapping_file.S</a> <span class="keyword">with</span> <span><span class="keyword">module</span> <a href="../../Mapping_file/module-type-S/Io/index.html">Io</a> = <a href="Fm/Io/index.html">Fm.Io</a></span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-location"><a href="#type-location" class="anchor"></a><code><span><span class="keyword">type</span> location</span><span> = <span class="keyword">private</span> </span></code><ol><li id="type-location.Prefix" class="def variant constructor anchored"><a href="#type-location.Prefix" class="anchor"></a><code><span>| </span><span><span class="constructor">Prefix</span></span></code></li><li id="type-location.Suffix" class="def variant constructor anchored"><a href="#type-location.Suffix" class="anchor"></a><code><span>| </span><span><span class="constructor">Suffix</span></span></code></li></ol></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-location_t"><a href="#val-location_t" class="anchor"></a><code><span><span class="keyword">val</span> location_t : <span><a href="#type-location">location</a> <span class="xref-unresolved">Irmin</span>.Type.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-accessor"><a href="#type-accessor" class="anchor"></a><code><span><span class="keyword">type</span> accessor</span><span> = <span class="keyword">private</span> </span><span>{</span></code><ol><li id="type-accessor.poff" class="def record field anchored"><a href="#type-accessor.poff" class="anchor"></a><code><span>poff : <span class="xref-unresolved">Optint</span>.Int63.t;</span></code></li><li id="type-accessor.len" class="def record field anchored"><a href="#type-accessor.len" class="anchor"></a><code><span>len : <span class="xref-unresolved">Optint</span>.Int63.t;</span></code></li><li id="type-accessor.location" class="def record field anchored"><a href="#type-accessor.location" class="anchor"></a><code><span>location : <a href="#type-location">location</a>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>An <code>accessor</code> designates a valid readable area in one of the pack files.</p><p>Accessors are meant to be used from within the <code>Irmin_pack_unix</code> implementation. Their validity is only checked at creation time, so they are not meant to be kept for a long time. (e.g. if kept over a GC finalisation, an accessor could no longer point to a valid area because the GC changes the domain of valid readable areas)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-accessor_t"><a href="#val-accessor_t" class="anchor"></a><code><span><span class="keyword">val</span> accessor_t : <span><a href="#type-accessor">accessor</a> <span class="xref-unresolved">Irmin</span>.Type.t</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-v"><a href="#val-v" class="anchor"></a><code><span><span class="keyword">val</span> v : <span><a href="Fm/index.html#type-t">Fm.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="#type-t">t</a>, <span>[&gt; <a href="Fm/Errs/index.html#type-t">Fm.Errs.t</a> ]</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_accessor_exn"><a href="#val-create_accessor_exn" class="anchor"></a><code><span><span class="keyword">val</span> create_accessor_exn : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>off:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span> <span>len:int <span class="arrow">&#45;&gt;</span></span> <a href="#type-accessor">accessor</a></span></code></div><div class="spec-doc"><p><code>create_accessor_exn</code> returns an accessor if <code>off</code> and <code>len</code> designate a readable area of the pack files, otherwise it raises one of <code>Errors.Pack_error `Read_out_of_bounds</code>, <code>Errors.Pack_error (`Invalid_prefix_read _)</code> and <code>Errors.Pack_error (`Invalid_read_of_gced_object _)</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_accessor_from_range_exn"><a href="#val-create_accessor_from_range_exn" class="anchor"></a><code><span><span class="keyword">val</span> create_accessor_from_range_exn : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>off:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span>
  <span>min_len:int <span class="arrow">&#45;&gt;</span></span>
  <span>max_len:int <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-accessor">accessor</a></span></code></div><div class="spec-doc"><p><code>create_accessor_from_maxlen_exn</code> is similar to <code>create_accessor_exn</code> except that the precise length of the span will be decided during the call.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_accessor_to_prefix_exn"><a href="#val-create_accessor_to_prefix_exn" class="anchor"></a><code><span><span class="keyword">val</span> create_accessor_to_prefix_exn : 
  <span><a href="Mapping_file/index.html#type-t">Mapping_file.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>off:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span>
  <span>len:int <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-accessor">accessor</a></span></code></div><div class="spec-doc"><p><code>create_accessor_to_prefix_exn mapping ~off ~len</code> returns an accessor for the prefix file associated with <code>mapping</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-shrink_accessor_exn"><a href="#val-shrink_accessor_exn" class="anchor"></a><code><span><span class="keyword">val</span> shrink_accessor_exn : <span><a href="#type-accessor">accessor</a> <span class="arrow">&#45;&gt;</span></span> <span>new_len:int <span class="arrow">&#45;&gt;</span></span> <a href="#type-accessor">accessor</a></span></code></div><div class="spec-doc"><p><code>shrink_accessor_exn a ~new_len</code> is <code>a</code> where the length is smaller than in <code>a</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create_sequential_accessor_seq"><a href="#val-create_sequential_accessor_seq" class="anchor"></a><code><span><span class="keyword">val</span> create_sequential_accessor_seq : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>min_header_len:int <span class="arrow">&#45;&gt;</span></span>
  <span>max_header_len:int <span class="arrow">&#45;&gt;</span></span>
  <span>read_len:<span>(<span>bytes <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="xref-unresolved">Optint</span>.Int63.t * <a href="#type-accessor">accessor</a>)</span> <a href="../../../../irmin/Irmin/Export_for_backends/Seq/index.html#type-t">Irmin.Export_for_backends.Seq.t</a></span></span></code></div><div class="spec-doc"><p><code>create_sequential_accessor_seq ~min_header_len ~max_header_len ~read_len</code> returns a sequence of accessors, which simulates iterating sequentially trough the entries of a pack file. <code>min_header_len</code> &amp; <code>max_header_len</code> represents the minimum &amp; maximum lengths required to read the header of an entry. <code>read_len</code> will then be called with a buffer containing the header of the entry and should return the total length of the entry (the length of he header plus the length of the payload)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_exn"><a href="#val-read_exn" class="anchor"></a><code><span><span class="keyword">val</span> read_exn : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-accessor">accessor</a> <span class="arrow">&#45;&gt;</span></span> <span>bytes <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>read_exn</code> either reads in the prefix or the suffix file, depending on <code>accessor</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-end_offset"><a href="#val-end_offset" class="anchor"></a><code><span><span class="keyword">val</span> end_offset : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Optint</span>.Int63.t</span></code></div><div class="spec-doc"><p><code>end_offset</code> is the end offsets of the pack entries, counting that the prefix doesn't start at 0. It counts the entries not yet flushed from the prefix.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-suffix_start_offset"><a href="#val-suffix_start_offset" class="anchor"></a><code><span><span class="keyword">val</span> suffix_start_offset : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Optint</span>.Int63.t</span></code></div><div class="spec-doc"><p><code>suffix_start_offset</code> is the offsets of the first pack entry in the suffix. All pack entries in the prefix fit below <code>suffix_start_offset</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-offset_of_soff"><a href="#val-offset_of_soff" class="anchor"></a><code><span><span class="keyword">val</span> offset_of_soff : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Optint</span>.Int63.t</span></code></div><div class="spec-doc"><p><code>offset_of_soff t suffix_off</code> converts a suffix offset into a (global) offset.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-soff_of_offset"><a href="#val-soff_of_offset" class="anchor"></a><code><span><span class="keyword">val</span> soff_of_offset : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Optint</span>.Int63.t</span></code></div><div class="spec-doc"><p><code>soff_of_offset t global_offset</code> converts a global offset to a suffix offset.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_bytes_exn"><a href="#val-read_bytes_exn" class="anchor"></a><code><span><span class="keyword">val</span> read_bytes_exn : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span>f:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>off:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span>
  <span>len:<span class="xref-unresolved">Optint</span>.Int63.t <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>read_bytes_exn</code> reads a slice of the global offset space defined by <code>off</code> and <code>len</code>.</p><p>The calls to <code>f</code> ignore the objects boundaries (i.e. the string passed to <code>f</code> will most of the time not be the beginning of an object).</p><p>The strings passed to <code>f</code> are safe. They can be kept around, they are not the result of an <code>unsafe_to_string</code> conversion.</p><p>The call will fail if the <code>(off, len)</code> range is invalid. It will succeed in these cases:</p><ul><li>If the range designates a slice of the suffix.</li><li>If the range designates a slice of contiguous live bytes in the prefix</li><li>If the range designates a slice of contiguous live bytes that starts in the prefix and ends in the suffix. This implies that the last chunk of the prefix is contiguous to the start of the suffix.</li></ul></div></div></div></body></html>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="next" href="Irmin_mem.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Irmin" rel="Chapter" href="Irmin.html">
<link title="Irmin_mem" rel="Chapter" href="Irmin_mem.html">
<link title="Irmin_unix" rel="Chapter" href="Irmin_unix.html"><link title="Preliminaries" rel="Section" href="#1_Preliminaries">
<link title="Stores" rel="Section" href="#1_Stores">
<link title="User-Defined Contents" rel="Section" href="#1_UserDefinedContents">
<link title="High-level Stores" rel="Section" href="#1_HighlevelStores">
<link title="Basic API" rel="Section" href="#basics">
<link title="Examples" rel="Section" href="#examples">
<link title="Helpers" rel="Section" href="#1_Helpers">
<link title="Backends" rel="Section" href="#backend">
<link title="Base Operations" rel="Subsection" href="#2_BaseOperations">
<link title="Tags" rel="Subsection" href="#2_Tags">
<link title="Heads" rel="Subsection" href="#2_Heads">
<link title="Clones and Merges" rel="Subsection" href="#2_ClonesandMerges">
<link title="History" rel="Subsection" href="#2_History">
<link title="Views" rel="Subsection" href="#2_Views">
<link title="Synchronisation" rel="Subsection" href="#2_Synchronisation">
<title>Irmin</title>
</head>
<body>
<div class="navbar">&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="Irmin_mem.html" title="Irmin_mem">Next</a>
</div>
<h1>Module <a href="type_Irmin.html">Irmin</a></h1>

<pre><span class="keyword">module</span> Irmin: <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info module top">
Irmin public API.
<p>

    <code class="code"><span class="constructor">Irmin</span></code> is a library to design and use persistent stores with
    built-in snapshot, branching and reverting mechanisms. Irmin uses
    concepts similar to <a href="http://git-scm.com/">Git</a> but it exposes
    them as a high level library instead of a complex command-line
    frontend. It features a <em>bidirectional</em> Git backend,
    fully-compatible with the usual Git tools and workflows.
<p>

    Irmin is designed to use a large variety of backends. It is
    written in pure OCaml and does not depend on external C stubs; it
    is thus very portable and aims is to run everywhere, from Linux to
    Xen unikernels.
<p>

    Consult the <a href="Irmin.html#basics"><i>Basic API</i></a> and <a href="Irmin.html#examples"><i>Examples</i></a> of use for a quick
    start. See also the <a href="Irmin_unix.html">documentation</a> for the unix
    backends.
<p>

    <em>Release %%VERSION%% - %%MAINTAINER%% </em><br>
</div>
<hr width="100%">

<pre><span id="VALversion"><span class="keyword">val</span> version</span> : <code class="type">string</code></pre><div class="info ">
The version of the library.<br>
</div>
<br>
<h1 id="1_Preliminaries">Preliminaries</h1><br>

<pre><span class="keyword">module</span> <a href="Irmin.Hum.html">Hum</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.Hum.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Serializable data with reversible human-readable
    representations.
</div>

<pre><span class="keyword">module</span> <a href="Irmin.Task.html">Task</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.Task.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Tasks are used to keep track of the origin of reads and writes in
    the store.
</div>

<pre><span class="keyword">module</span> <a href="Irmin.Merge.html">Merge</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.Merge.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
<code class="code"><span class="constructor">Merge</span></code> provides functions to build custom 3-way merge operators
    for various user-defined contents.
</div>
<br>
<h1 id="1_Stores">Stores</h1><br>

<pre><span id="TYPEtask"><span class="keyword">type</span> <code class="type"></code>task</span> = <code class="type">Task.t</code> </pre>
<div class="info ">
The type for user-defined tasks. See <a href="Irmin.Task.html">Task</a>.<br>
</div>


<pre><span id="TYPEconfig"><span class="keyword">type</span> <code class="type"></code>config</span> </pre>
<div class="info ">
The type for backend-specific configuration values.
<p>

    Every backend has different configuration options, which are kept
    abstract to the user.<br>
</div>

<br>
An Irmin store is automatically built from a number of lower-level
    stores, implementing fewer operations, such as <a href="Irmin.AO.html">append-only</a>
    and <a href="Irmin.RW.html">read-write</a> stores. These low-level stores are provided
    by various backends.<br>

<pre><span class="keyword">module type</span> <a href="Irmin.RO.html">RO</a> = <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.RO.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Read-only stores.
</div>

<pre><span class="keyword">module type</span> <a href="Irmin.AO.html">AO</a> = <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.AO.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Append-only store.
</div>

<pre><span class="keyword">module type</span> <a href="Irmin.RW.html">RW</a> = <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.RW.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Read-write stores.
</div>

<pre><span class="keyword">module type</span> <a href="Irmin.HRW.html">HRW</a> = <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.HRW.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Hierarchical read-write stores.
</div>

<pre><span class="keyword">module type</span> <a href="Irmin.BC.html">BC</a> = <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.BC.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Branch-consistent stores.
</div>
<br>
<h1 id="1_UserDefinedContents">User-Defined Contents</h1><br>

<pre><span class="keyword">module</span> <a href="Irmin.Path.html">Path</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.Path.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Store paths.
</div>

<pre><span class="keyword">module</span> <a href="Irmin.Hash.html">Hash</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.Hash.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Hashing functions.
</div>

<pre><span class="keyword">module</span> <a href="Irmin.Contents.html">Contents</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.Contents.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
<code class="code"><span class="constructor">Contents</span></code> specifies how user-defined contents need to be <em>    serializable</em> and <em>mergeable</em>.
</div>

<pre><span class="keyword">module</span> <a href="Irmin.Tag.html">Tag</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.Tag.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
User-defined tags.
</div>
<br>
<h1 id="1_HighlevelStores">High-level Stores</h1>
<p>

    An Irmin store is a branch-consistent store where keys are lists
    of steps.
<p>

    An example is a Git repository where keys are filenames, <em>i.e.</em>
    list of <code class="code">'\'</code>-separated strings. More complex examples are
    structured values, where steps might contains first-class fields
    accessors and array offsets.
<p>

    Irmin provides the follow gin features:
<p>

    <ul>
<li>Support for fast <a href="Irmin.BC.html">clones</a>, branches and merges, in a
    fashion very similar to Git.</li>
<li>Efficient <a href="Irmin.View.html">staging areas</a> for fast, transient,
    in-memory operations.</li>
<li>Space efficient <a href="Irmin.Snapshot.html">snapshots</a> and fast and consistent
    rollback operations.</li>
<li>Fast <a href="Irmin.Sync.html">synchronization</a> primitives between remote
    stores, using native backend protocols (as the Git protocol) when
    available.</li>
</ul>
<br>

<pre><span class="keyword">module</span> <a href="Irmin.Private.html">Private</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.Private.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
<code class="code"><span class="constructor">Private</span></code> defines functions only useful for creating new
    backends.
</div>

<pre><span class="keyword">module type</span> <a href="Irmin.S.html">S</a> = <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.S.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Signature for Irmin stores.
</div>

<pre><span class="keyword">module type</span> <a href="Irmin.S_MAKER.html">S_MAKER</a> = <code class="code">(</code><code class="code"><span class="constructor">C</span></code><code class="code"> : </code><code class="type"><a href="Irmin.Contents.S.html">Contents.S</a></code><code class="code">) </code><code class="code">(</code><code class="code"><span class="constructor">T</span></code><code class="code"> : </code><code class="type"><a href="Irmin.Tag.S.html">Tag.S</a></code><code class="code">) </code><code class="code">(</code><code class="code"><span class="constructor">H</span></code><code class="code"> : </code><code class="type"><a href="Irmin.Hash.S.html">Hash.S</a></code><code class="code">) </code><code class="type"><a href="Irmin.S.html">S</a></code><code class="type">  with type key = C.Path.t
       and type value = C.t
       and type tag = T.t
       and type head = H.t</code></pre><div class="info">
<code class="code"><span class="constructor">S_MAKER</span></code> is the signature exposed by any backend providing <a href="Irmin.S.html"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">S</span></code></a>
    implementations.
</div>
<br>
<h1 id="basics">Basic API</h1><br>
<br>
The basic API considers default Irmin implementations using:
<p>

    <ul>
<li><a href="Irmin.Path.String_list.html">list of strings</a> as keys.</li>
<li><a href="Irmin.Tag.String.html">strings</a> as tags.</li>
<li><a href="Irmin.Hash.SHA1.html">SHA1</a> as internal digests.</li>
</ul>

<p>

    Only the <a href="Irmin.Contents.S.html">contents</a> is provided by the user.<br>

<pre><span class="keyword">module type</span> <a href="Irmin.BASIC.html">BASIC</a> = <code class="type"><a href="Irmin.S.html">S</a></code><code class="type">  with type tag = string and type head = Hash.SHA1.t</code></pre><div class="info">
The signature of basic stores.
</div>

<pre><span class="keyword">module</span> <a href="Irmin.Basic.html">Basic</a> <code class="code">(</code><code class="code"><span class="constructor">B</span></code><code class="code"> : </code><code class="type"><a href="Irmin.S_MAKER.html">S_MAKER</a></code><code class="code">) </code> <code class="code">(</code><code class="code"><span class="constructor">C</span></code><code class="code"> : </code><code class="type"><a href="Irmin.Contents.S.html">Contents.S</a></code><code class="code">) </code>: <code class="type"><a href="Irmin.BASIC.html">BASIC</a></code><code class="type">  with type key = C.Path.t and type value = C.t</code></pre><div class="info">
Generate a basic store using <code class="code"><span class="constructor">B</span></code> as backend and <code class="code"><span class="constructor">C</span></code> as
    user-provided contents.
</div>

<pre><span id="TYPEbasic"><span class="keyword">type</span> <code class="type">('k, 'v)</code> basic</span> = <code class="type">(module Irmin.BASIC with type key = 'k and type value = 'v)</code> </pre>
<div class="info ">
The type for basic stores.<br>
</div>


<pre><span id="TYPEcontents"><span class="keyword">type</span> <code class="type">('k, 'v)</code> contents</span> = <code class="type">(module Irmin.Contents.S with type t = 'v and type Path.t = 'k)</code> </pre>
<div class="info ">
The type for basic contents of type <code class="code"><span class="keywordsign">'</span>a</code>.<br>
</div>


<pre><span id="VALbasic"><span class="keyword">val</span> basic</span> : <code class="type">(module Irmin.S_MAKER) -> ('k, 'v) <a href="Irmin.html#TYPEcontents">contents</a> -> ('k, 'v) <a href="Irmin.html#TYPEbasic">basic</a></code></pre><div class="info ">
<code class="code">basic backend contents</code> is a basic Irmin implementation using
    <code class="code">backend</code> as a backend and containing values defined by
    <code class="code">contents</code>.<br>
</div>

<pre><span id="TYPEt"><span class="keyword">type</span> <code class="type">('a, 'k, 'v)</code> t</span> </pre>
<div class="info ">
The type for default store, with keys of type <code class="code"><span class="keywordsign">'</span>k</code> and values of
    type <code class="code"><span class="keywordsign">'</span>v</code>. <code class="code"><span class="keywordsign">'</span>a</code> is a phantom type representing the store's kind:
    read-only, read-write or branch-consistent.<br>
</div>


<pre><span id="VALimpl"><span class="keyword">val</span> impl</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> ('k, 'v) <a href="Irmin.html#TYPEbasic">basic</a></code></pre><div class="info ">
<code class="code">impl t</code> is the store implementation of <code class="code">t</code>.<br>
</div>

<pre><span id="VALcreate"><span class="keyword">val</span> create</span> : <code class="type">('k, 'v) <a href="Irmin.html#TYPEbasic">basic</a> -><br>       <a href="Irmin.html#TYPEconfig">config</a> -> ('m -> <a href="Irmin.html#TYPEtask">task</a>) -> ('m -> ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a>) Lwt.t</code></pre><div class="info ">
See <a href="Irmin.RO.html#VALcreate"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">RO</span>.create</code></a>. Needs a backend as first argument.<br>
</div>

<pre><span id="VALof_tag"><span class="keyword">val</span> of_tag</span> : <code class="type">('k, 'v) <a href="Irmin.html#TYPEbasic">basic</a> -><br>       <a href="Irmin.html#TYPEconfig">config</a> -><br>       ('m -> <a href="Irmin.html#TYPEtask">task</a>) -> string -> ('m -> ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a>) Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALof_tag"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.of_tag</code></a>. Needs a backend as first argument.<br>
</div>

<pre><span id="VALof_head"><span class="keyword">val</span> of_head</span> : <code class="type">('k, 'v) <a href="Irmin.html#TYPEbasic">basic</a> -><br>       <a href="Irmin.html#TYPEconfig">config</a> -><br>       ('m -> <a href="Irmin.html#TYPEtask">task</a>) -> Hash.SHA1.t -> ('m -> ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a>) Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALof_head"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.of_head</code></a>. Needs a backend as first argument.<br>
</div>
<br>
<h2 id="2_BaseOperations">Base Operations</h2><br>

<pre><span id="VALread"><span class="keyword">val</span> read</span> : <code class="type">([< `BC | `HRW | `RO ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> 'k -> 'v option Lwt.t</code></pre><div class="info ">
See <a href="Irmin.RO.html#VALread"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">RO</span>.read</code></a>.<br>
</div>

<pre><span id="VALread_exn"><span class="keyword">val</span> read_exn</span> : <code class="type">([< `BC | `HRW | `RO ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> 'k -> 'v Lwt.t</code></pre><div class="info ">
See <a href="Irmin.RO.html#VALread_exn"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">RO</span>.read_exn</code></a>.<br>
</div>

<pre><span id="VALmem"><span class="keyword">val</span> mem</span> : <code class="type">([< `BC | `HRW | `RO ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> 'k -> bool Lwt.t</code></pre><div class="info ">
See <a href="Irmin.RO.html#VALmem"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">RO</span>.mem</code></a>.<br>
</div>

<pre><span id="VALwatch"><span class="keyword">val</span> watch</span> : <code class="type">([< `BC | `HRW | `RO ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> 'k -> 'v option Lwt_stream.t</code></pre><div class="info ">
See <a href="Irmin.RW.html#VALwatch"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">RW</span>.watch</code></a>.<br>
</div>

<pre><span id="VALwatch_all"><span class="keyword">val</span> watch_all</span> : <code class="type">([< `BC | `HRW | `RO ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> ('k * 'v option) Lwt_stream.t</code></pre><div class="info ">
See <a href="Irmin.RW.html#VALwatch_all"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">RW</span>.watch_all</code></a><br>
</div>

<pre><span id="VALiter"><span class="keyword">val</span> iter</span> : <code class="type">([< `BC | `HRW | `RO ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> ('k -> unit Lwt.t) -> unit Lwt.t</code></pre><div class="info ">
See <a href="Irmin.RW.html#VALiter"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">RW</span>.iter</code></a>.<br>
</div>

<pre><span id="VALlist"><span class="keyword">val</span> list</span> : <code class="type">([< `BC | `HRW | `RO ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> 'k -> 'k list Lwt.t</code></pre><div class="info ">
See <a href="Irmin.HRW.html#VALlist"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">HRW</span>.list</code></a>.<br>
</div>

<pre><span id="VALupdate"><span class="keyword">val</span> update</span> : <code class="type">([< `BC | `HRW ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> 'k -> 'v -> unit Lwt.t</code></pre><div class="info ">
See <a href="Irmin.RW.html#VALupdate"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">RW</span>.update</code></a>.<br>
</div>

<pre><span id="VALremove"><span class="keyword">val</span> remove</span> : <code class="type">([< `BC | `HRW ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> 'k -> unit Lwt.t</code></pre><div class="info ">
See <a href="Irmin.RW.html#VALremove"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">RW</span>.remove</code></a>.<br>
</div>

<pre><span id="VALremove_rec"><span class="keyword">val</span> remove_rec</span> : <code class="type">([< `BC | `HRW ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> 'k -> unit Lwt.t</code></pre><div class="info ">
See <a href="Irmin.HRW.html#VALremove_rec"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">HRW</span>.remove_rec</code></a>.<br>
</div>
<br>
<h2 id="2_Tags">Tags</h2><br>

<pre><span id="VALtag"><span class="keyword">val</span> tag</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> string option Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALtag"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.tag</code></a>.<br>
</div>

<pre><span id="VALtag_exn"><span class="keyword">val</span> tag_exn</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> string Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALtag_exn"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.tag_exn</code></a>.<br>
</div>

<pre><span id="VALtags"><span class="keyword">val</span> tags</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> string list Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALtags"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.tags</code></a>.<br>
</div>

<pre><span id="VALremove_tag"><span class="keyword">val</span> remove_tag</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> unit Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALremove_tag"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.remove_tag</code></a>.<br>
</div>

<pre><span id="VALupdate_tag"><span class="keyword">val</span> update_tag</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> string -> unit Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALupdate_tag"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.update_tag</code></a>.<br>
</div>

<pre><span id="VALmerge_tag"><span class="keyword">val</span> merge_tag</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -><br>       ?max_depth:int -> ?n:int -> string -> unit <a href="Irmin.Merge.html#TYPEresult">Merge.result</a> Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALmerge_tag"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.merge_tag</code></a>.<br>
</div>

<pre><span id="VALmerge_tag_exn"><span class="keyword">val</span> merge_tag_exn</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> ?max_depth:int -> ?n:int -> string -> unit Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALmerge_tag_exn"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.merge_tag_exn</code></a>.<br>
</div>
<br>
<h2 id="2_Heads">Heads</h2><br>

<pre><span id="VALhead"><span class="keyword">val</span> head</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> Hash.SHA1.t option Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALhead"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.head</code></a>.<br>
</div>

<pre><span id="VALhead_exn"><span class="keyword">val</span> head_exn</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> Hash.SHA1.t Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALhead_exn"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.head_exn</code></a>.<br>
</div>

<pre><span id="VALbranch"><span class="keyword">val</span> branch</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> [ `Head of Hash.SHA1.t | `Tag of string ]</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALbranch"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.branch</code></a>.<br>
</div>

<pre><span id="VALheads"><span class="keyword">val</span> heads</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> Hash.SHA1.t list Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALheads"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.heads</code></a>.<br>
</div>

<pre><span id="VALupdate_head"><span class="keyword">val</span> update_head</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> Hash.SHA1.t -> unit Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALupdate_head"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.update_head</code></a>.<br>
</div>

<pre><span id="VALmerge_head"><span class="keyword">val</span> merge_head</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -><br>       ?max_depth:int -> ?n:int -> Hash.SHA1.t -> unit <a href="Irmin.Merge.html#TYPEresult">Merge.result</a> Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALmerge_head"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.merge_head</code></a>.<br>
</div>

<pre><span id="VALmerge_head_exn"><span class="keyword">val</span> merge_head_exn</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -><br>       ?max_depth:int -> ?n:int -> Hash.SHA1.t -> unit Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALmerge_head_exn"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.merge_head_exn</code></a>.<br>
</div>

<pre><span id="VALwatch_head"><span class="keyword">val</span> watch_head</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> 'k -> ('k * Hash.SHA1.t option) Lwt_stream.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALwatch_head"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.watch_head</code></a>.<br>
</div>

<pre><span id="VALwatch_tags"><span class="keyword">val</span> watch_tags</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> (string * Hash.SHA1.t option) Lwt_stream.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALwatch_tags"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.watch_tags</code></a>.<br>
</div>
<br>
<h2 id="2_ClonesandMerges">Clones and Merges</h2><br>

<pre><span id="VALclone"><span class="keyword">val</span> clone</span> : <code class="type">('m -> <a href="Irmin.html#TYPEtask">task</a>) -><br>       ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -><br>       string -> [ `Duplicated_tag | `Ok of 'm -> ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> ] Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALclone"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.clone</code></a>.<br>
</div>

<pre><span id="VALclone_force"><span class="keyword">val</span> clone_force</span> : <code class="type">('m -> <a href="Irmin.html#TYPEtask">task</a>) -><br>       ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -><br>       string -> ('m -> ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a>) Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALclone_force"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.clone_force</code></a>.<br>
</div>

<pre><span id="VALmerge"><span class="keyword">val</span> merge</span> : <code class="type">'m -><br>       ?max_depth:int -><br>       ?n:int -><br>       ('m -> ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a>) -><br>       into:('m -> ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a>) -> unit <a href="Irmin.Merge.html#TYPEresult">Merge.result</a> Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALmerge"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.merge</code></a>.<br>
</div>

<pre><span id="VALmerge_exn"><span class="keyword">val</span> merge_exn</span> : <code class="type">'m -><br>       ?max_depth:int -><br>       ?n:int -><br>       ('m -> ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a>) -><br>       into:('m -> ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a>) -> unit Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALmerge_exn"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.merge_exn</code></a>.<br>
</div>

<pre><span id="VALlcas"><span class="keyword">val</span> lcas</span> : <code class="type">'m -><br>       ?max_depth:int -><br>       ?n:int -><br>       ('m -> ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a>) -><br>       ('m -> ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a>) -><br>       [ `Max_depth_reached | `Ok of Hash.SHA1.t list | `Too_many_lcas ] Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALlcas"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.lcas</code></a>.<br>
</div>

<pre><span id="VALlcas_tag"><span class="keyword">val</span> lcas_tag</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -><br>       ?max_depth:int -><br>       ?n:int -><br>       string -><br>       [ `Max_depth_reached | `Ok of Hash.SHA1.t list | `Too_many_lcas ] Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALlcas_tag"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.lcas_tag</code></a>.<br>
</div>

<pre><span id="VALlcas_head"><span class="keyword">val</span> lcas_head</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -><br>       ?max_depth:int -><br>       ?n:int -><br>       Hash.SHA1.t -><br>       [ `Max_depth_reached | `Ok of Hash.SHA1.t list | `Too_many_lcas ] Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALlcas_head"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.lcas_head</code></a>.<br>
</div>
<br>
<h2 id="2_History">History</h2><br>

<pre><span class="keyword">module</span> <a href="Irmin.History.html">History</a>: <code class="type">Graph.Sig.P</code><code class="type">  with type V.t = Hash.SHA1.t</code></pre><div class="info">
See <a href="Irmin.BC.History.html"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.<span class="constructor">History</span></code></a>.
</div>

<pre><span id="VALhistory"><span class="keyword">val</span> history</span> : <code class="type">?depth:int -><br>       ?min:Hash.SHA1.t list -><br>       ?max:Hash.SHA1.t list -> ([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> History.t Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALhistory"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.history</code></a>.<br>
</div>

<pre><span id="VALtask_of_head"><span class="keyword">val</span> task_of_head</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> Hash.SHA1.t -> <a href="Irmin.html#TYPEtask">task</a> Lwt.t</code></pre><div class="info ">
See <a href="Irmin.BC.html#VALtask_of_head"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">BC</span>.task_of_head</code></a>.<br>
</div>
<br>
<h2 id="2_Views">Views</h2><br>

<pre><span id="VALwith_hrw_view"><span class="keyword">val</span> with_hrw_view</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -><br>       ?path:'k -><br>       [ `Merge | `Rebase | `Update ] -><br>       (([ `HRW ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> unit Lwt.t) -> unit <a href="Irmin.Merge.html#TYPEresult">Merge.result</a> Lwt.t</code></pre><div class="info ">
<code class="code">with_rw_view t task ?path strat ops</code> applies <code class="code">ops</code> to an
    in-memory, temporary and mutable view of the store <code class="code">t</code>. If <code class="code">path</code>
    is set, all operations in the transaction are relative the that
    path, otherwise use the full tree. The <code class="code">strat</code> strategy decides
    which merging strategy to use: see <a href="Irmin.VIEW.html#VALupdate_path"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">VIEW</span>.update_path</code></a>,
    <a href="Irmin.VIEW.html#VALrebase_path"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">VIEW</span>.rebase_path</code></a> and <a href="Irmin.VIEW.html#VALmerge_path"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">VIEW</span>.merge_path</code></a>.<br>
</div>
<br>
<h2 id="2_Synchronisation">Synchronisation</h2><br>

<pre><span id="TYPEremote"><span class="keyword">type</span> <code class="type"></code>remote</span> </pre>
<div class="info ">
The type for remote stores.<br>
</div>


<pre><span id="VALremote_uri"><span class="keyword">val</span> remote_uri</span> : <code class="type">string -> <a href="Irmin.html#TYPEremote">remote</a></code></pre><div class="info ">
<code class="code">remote_uri s</code> is the remote store located at <code class="code">uri</code>. Use the
    optimized native synchronization protocol when available for the
    given backend.<br>
</div>

<pre><span id="VALremote_basic"><span class="keyword">val</span> remote_basic</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> <a href="Irmin.html#TYPEremote">remote</a></code></pre><div class="info ">
Same as <a href="Irmin.html#VALremote_store"><code class="code"><span class="constructor">Irmin</span>.remote_store</code></a> but for basic stores.<br>
</div>

<pre><span id="VALfetch"><span class="keyword">val</span> fetch</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -><br>       ?depth:int -> <a href="Irmin.html#TYPEremote">remote</a> -> Hash.SHA1.t option Lwt.t</code></pre><div class="info ">
See <a href="Irmin.Sync.html#VALfetch"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">Sync</span>.fetch</code></a>.<br>
</div>

<pre><span id="VALfetch_exn"><span class="keyword">val</span> fetch_exn</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> ?depth:int -> <a href="Irmin.html#TYPEremote">remote</a> -> Hash.SHA1.t Lwt.t</code></pre><div class="info ">
See <a href="Irmin.Sync.html#VALfetch_exn"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">Sync</span>.fetch_exn</code></a>.<br>
</div>

<pre><span id="VALpull"><span class="keyword">val</span> pull</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -><br>       ?depth:int -><br>       <a href="Irmin.html#TYPEremote">remote</a> -> [ `Merge | `Update ] -> unit <a href="Irmin.Merge.html#TYPEresult">Merge.result</a> Lwt.t</code></pre><div class="info ">
See <a href="Irmin.Sync.html#VALpull"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">Sync</span>.pull</code></a>.<br>
</div>

<pre><span id="VALpull_exn"><span class="keyword">val</span> pull_exn</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -><br>       ?depth:int -> <a href="Irmin.html#TYPEremote">remote</a> -> [ `Merge | `Update ] -> unit Lwt.t</code></pre><div class="info ">
See <a href="Irmin.Sync.html#VALpull_exn"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">Sync</span>.pull_exn</code></a>.<br>
</div>

<pre><span id="VALpush"><span class="keyword">val</span> push</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -><br>       ?depth:int -> <a href="Irmin.html#TYPEremote">remote</a> -> [ `Error | `Ok ] Lwt.t</code></pre><div class="info ">
See <a href="Irmin.Sync.html#VALpush"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">Sync</span>.push</code></a>.<br>
</div>

<pre><span id="VALpush_exn"><span class="keyword">val</span> push_exn</span> : <code class="type">([ `BC ], 'k, 'v) <a href="Irmin.html#TYPEt">t</a> -> ?depth:int -> <a href="Irmin.html#TYPEremote">remote</a> -> unit Lwt.t</code></pre><div class="info ">
See <a href="Irmin.Sync.html#VALpush_exn"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">Sync</span>.push_exn</code></a>.<br>
</div>
<br>
<h1 id="examples">Examples</h1>
<p>

    These examples are in the <code class="code">examples</code> directory of the
    distribution.
<p>

    <h3 id="3_Synchronisation">Synchronisation</h3>
<p>

    A simple synchronization example, using the
    <a href="Irmin_unix.Irmin_git.html">Git</a> backend and the <a href="Irmin.Sync.html"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">Sync</span></code></a> helpers. The
    code clones a fresh repository if the repository does not exists
    locally, otherwise it performs a fetch: in this case, only
    the missing contents is downloaded.
<p>

<pre class="codepre"><code class="code"><span class="keyword">open</span>&nbsp;<span class="constructor">Lwt</span><br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Irmin_unix</span><br>
<br>
<span class="keyword">let</span>&nbsp;store&nbsp;=&nbsp;<span class="constructor">Irmin</span>.basic&nbsp;(<span class="keyword">module</span>&nbsp;<span class="constructor">Irmin_git</span>.<span class="constructor">FS</span>)&nbsp;(<span class="keyword">module</span>&nbsp;<span class="constructor">Irmin</span>.<span class="constructor">Contents</span>.<span class="constructor">String</span>)<br>
<span class="keyword">let</span>&nbsp;config&nbsp;=&nbsp;<span class="constructor">Irmin_git</span>.config&nbsp;~root:<span class="string">"/tmp/test"</span>&nbsp;()<br>
<br>
<span class="keyword">let</span>&nbsp;upstream&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">Array</span>.length&nbsp;<span class="constructor">Sys</span>.argv&nbsp;=&nbsp;2&nbsp;<span class="keyword">then</span>&nbsp;(<span class="constructor">Irmin</span>.remote_uri&nbsp;<span class="constructor">Sys</span>.argv.(1))<br>
&nbsp;&nbsp;<span class="keyword">else</span>&nbsp;(<span class="constructor">Printf</span>.eprintf&nbsp;<span class="string">"Usage:&nbsp;sync&nbsp;[uri]\n%!"</span>;&nbsp;exit&nbsp;1)<br>
<br>
<span class="keyword">let</span>&nbsp;test&nbsp;()&nbsp;=<br>
&nbsp;&nbsp;<span class="constructor">Irmin</span>.create&nbsp;store&nbsp;config&nbsp;task<br>
&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;t&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Irmin</span>.pull_exn&nbsp;(t&nbsp;<span class="string">"Syncing&nbsp;with&nbsp;upstream&nbsp;store"</span>)&nbsp;upstream&nbsp;<span class="keywordsign">`</span><span class="constructor">Update</span><br>
&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Irmin</span>.read_exn&nbsp;(t&nbsp;<span class="string">"get&nbsp;the&nbsp;README"</span>)&nbsp;[<span class="string">"README.md"</span>]<br>
&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;r&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Printf</span>.printf&nbsp;<span class="string">"%s\n%!"</span>&nbsp;r;&nbsp;return_unit<br>
<br>
<span class="keyword">let</span>&nbsp;()&nbsp;=<br>
&nbsp;&nbsp;<span class="constructor">Lwt_main</span>.run&nbsp;(test&nbsp;())<br>
</code></pre>
<p>

    <h3 id="3_Mergeablelogs">Mergeable logs</h3>
<p>

    We will demonstrate the use of custom merge operators by
    defining mergeable debug log files. We first define a log entry
    as a pair of a timestamp and a message, using the combinator
    exposed by <a href="https://github.com/mirage/mirage-tc">mirage-tc</a>:
<p>

<pre class="codepre"><code class="code">&nbsp;&nbsp;<span class="keyword">module</span>&nbsp;<span class="constructor">Entry</span>&nbsp;=&nbsp;<span class="keyword">struct</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">include</span>&nbsp;<span class="constructor">Tc</span>.<span class="constructor">Pair</span>&nbsp;(<span class="constructor">Tc</span>.<span class="constructor">Int</span>)(<span class="constructor">Tc</span>.<span class="constructor">String</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;compare&nbsp;(x,&nbsp;_)&nbsp;(y,&nbsp;_)&nbsp;=&nbsp;<span class="constructor">Pervasives</span>.compare&nbsp;x&nbsp;y<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;time&nbsp;=&nbsp;ref&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;create&nbsp;message&nbsp;=&nbsp;incr&nbsp;time;&nbsp;!time,&nbsp;message<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
</code></pre>
<p>

    A log file is a list of entries (one per line), ordered by
    decreasing order of timestamps. The 3-way <code class="code">merge</code> operator for log
    files concatenates and sorts the new entries and prepend them
    to the common ancestor's ones.
<p>

<pre class="codepre"><code class="code">&nbsp;&nbsp;<span class="keyword">module</span>&nbsp;<span class="constructor">Log</span>:&nbsp;<span class="constructor">Irmin</span>.<span class="constructor">Contents</span>.<span class="constructor">S</span>&nbsp;<span class="keyword">with</span>&nbsp;<span class="keyword">type</span>&nbsp;t&nbsp;=&nbsp;<span class="constructor">Entry</span>.t&nbsp;list&nbsp;=&nbsp;<span class="keyword">struct</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">module</span>&nbsp;<span class="constructor">Path</span>&nbsp;=&nbsp;<span class="constructor">Irmin</span>.<span class="constructor">Path</span>.<span class="constructor">String_list</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">module</span>&nbsp;<span class="constructor">S</span>&nbsp;=&nbsp;<span class="constructor">Tc</span>.<span class="constructor">List</span>(<span class="constructor">Entry</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">include</span>&nbsp;<span class="constructor">S</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Get&nbsp;the&nbsp;timestamp&nbsp;of&nbsp;the&nbsp;latest&nbsp;entry.&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;timestamp&nbsp;=&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;[]&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;(timestamp,&nbsp;_&nbsp;)&nbsp;::&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;timestamp<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Compute&nbsp;the&nbsp;entries&nbsp;newer&nbsp;than&nbsp;the&nbsp;given&nbsp;timestamp.&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;newer_than&nbsp;timestamp&nbsp;entries&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;aux&nbsp;acc&nbsp;=&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;[]&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">List</span>.rev&nbsp;acc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;(h,&nbsp;_)&nbsp;::&nbsp;_&nbsp;<span class="keyword">when</span>&nbsp;h&nbsp;&lt;=&nbsp;timestamp&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">List</span>.rev&nbsp;acc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;h::t&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;aux&nbsp;(h::acc)&nbsp;t<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;aux&nbsp;[]&nbsp;entries<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;merge_log&nbsp;_path&nbsp;~old&nbsp;t1&nbsp;t2&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">Irmin</span>.<span class="constructor">Merge</span>.<span class="constructor">OP</span>&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;old&nbsp;()&nbsp;&gt;&gt;|&nbsp;<span class="keyword">fun</span>&nbsp;old&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;old&nbsp;=&nbsp;<span class="keyword">match</span>&nbsp;old&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;[]&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;o&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;o&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ts&nbsp;=&nbsp;timestamp&nbsp;old&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;t1&nbsp;=&nbsp;newer_than&nbsp;ts&nbsp;t1&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;t2&nbsp;=&nbsp;newer_than&nbsp;ts&nbsp;t2&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;t3&nbsp;=&nbsp;<span class="constructor">List</span>.sort&nbsp;<span class="constructor">Entry</span>.compare&nbsp;(<span class="constructor">List</span>.rev_append&nbsp;t1&nbsp;t2)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ok&nbsp;(<span class="constructor">List</span>.rev_append&nbsp;t3&nbsp;old)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;merge&nbsp;path&nbsp;=&nbsp;<span class="constructor">Irmin</span>.<span class="constructor">Merge</span>.option&nbsp;(<span class="keyword">module</span>&nbsp;<span class="constructor">S</span>)&nbsp;(merge_log&nbsp;path)<br>
<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
</code></pre>
<p>

    <b>Note:</b> The serialization primitives provided by
    <a href="https://github.com/mirage/mirage-tc">mirage-tc</a>: are not very
    efficient in this case as they parse the file every-time. For real
    usage, you would write buffered versions of <code class="code"><span class="constructor">Log</span>.read</code> and
    <code class="code"><span class="constructor">Log</span>.write</code>.
<p>

    To persist the log file on disk, we need to choose a backend. We
    show here how to use the on-disk <code class="code"><span class="constructor">Git</span></code> backend on Unix.
<p>

<pre class="codepre"><code class="code">&nbsp;&nbsp;<span class="comment">(*&nbsp;Bring&nbsp;[Irmin_unix.task]&nbsp;and&nbsp;[Irmin_unix.Irmin_git]&nbsp;in&nbsp;scope.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">Irmin_unix</span><br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Build&nbsp;an&nbsp;Irmin&nbsp;store&nbsp;containing&nbsp;log&nbsp;files.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;store&nbsp;=&nbsp;<span class="constructor">Irmin</span>.basic&nbsp;(<span class="keyword">module</span>&nbsp;<span class="constructor">Irmin_git</span>.<span class="constructor">FS</span>)&nbsp;(<span class="keyword">module</span>&nbsp;<span class="constructor">Log</span>)<br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Set-up&nbsp;the&nbsp;local&nbsp;configuration&nbsp;of&nbsp;the&nbsp;Git&nbsp;repository.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;config&nbsp;=&nbsp;<span class="constructor">Irmin_git</span>.config&nbsp;~root:<span class="string">"/tmp/irmin/test"</span>&nbsp;~bare:<span class="keyword">true</span>&nbsp;()<br>
</code></pre>
<p>

  We can now define a toy example to use our mergeable log files.
<p>

<pre class="codepre"><code class="code">&nbsp;&nbsp;<span class="keyword">open</span>&nbsp;<span class="constructor">Lwt</span><br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Name&nbsp;of&nbsp;the&nbsp;log&nbsp;file.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;file&nbsp;=&nbsp;[&nbsp;<span class="string">"local"</span>;&nbsp;<span class="string">"debug"</span>&nbsp;]<br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Read&nbsp;the&nbsp;entire&nbsp;log&nbsp;file.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;read_file&nbsp;t&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Irmin</span>.read&nbsp;(t&nbsp;<span class="string">"Reading&nbsp;the&nbsp;log&nbsp;file"</span>)&nbsp;file&nbsp;&gt;&gt;=&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">None</span>&nbsp;&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;return_nil<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;l&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;return&nbsp;l<br>
<br>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Persist&nbsp;a&nbsp;new&nbsp;entry&nbsp;in&nbsp;the&nbsp;log.&nbsp;*)</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;log&nbsp;t&nbsp;fmt&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.ksprintf&nbsp;(<span class="keyword">fun</span>&nbsp;message&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_file&nbsp;t&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;logs&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;logs&nbsp;=&nbsp;<span class="constructor">Entry</span>.create&nbsp;message&nbsp;::&nbsp;logs&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Irmin</span>.update&nbsp;(t&nbsp;<span class="string">"Adding&nbsp;a&nbsp;new&nbsp;entry"</span>)&nbsp;file&nbsp;logs<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;fmt<br>
<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;()&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Lwt_unix</span>.run&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Irmin</span>.create&nbsp;store&nbsp;config&nbsp;task<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;t&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;log&nbsp;t&nbsp;<span class="string">"Adding&nbsp;a&nbsp;new&nbsp;log&nbsp;entry"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Irmin</span>.clone_force&nbsp;task&nbsp;(t&nbsp;<span class="string">"Cloning&nbsp;the&nbsp;store"</span>)&nbsp;<span class="string">"x"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;x&nbsp;&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;log&nbsp;x&nbsp;<span class="string">"Adding&nbsp;new&nbsp;stuff&nbsp;to&nbsp;x"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;log&nbsp;x&nbsp;<span class="string">"Adding&nbsp;more&nbsp;stuff&nbsp;to&nbsp;x"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;log&nbsp;x&nbsp;<span class="string">"More.&nbsp;Stuff.&nbsp;To&nbsp;x."</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;log&nbsp;t&nbsp;<span class="string">"I&nbsp;can&nbsp;add&nbsp;stuff&nbsp;on&nbsp;t&nbsp;also"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;log&nbsp;t&nbsp;<span class="string">"Yes.&nbsp;On&nbsp;t!"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Irmin</span>.merge_exn&nbsp;<span class="string">"Merging&nbsp;x&nbsp;into&nbsp;t"</span>&nbsp;x&nbsp;~into:t<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&gt;&gt;=&nbsp;<span class="keyword">fun</span>&nbsp;()&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;return_unit<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
</code></pre><br>
<br>
<h1 id="1_Helpers">Helpers</h1><br>

<pre><span id="VALremote_store"><span class="keyword">val</span> remote_store</span> : <code class="type">(module Irmin.S with type t = 'a) -> 'a -> <a href="Irmin.html#TYPEremote">remote</a></code></pre><div class="info ">
<code class="code">remote_store t</code> is the remote corresponding to the local store
    <code class="code">t</code>. Synchronization is done by importing and exporting store
    <a href="Irmin.BC.html#TYPEslice">slices</a>, so this is usually much slower than native
    synchronization using <a href="Irmin.html#VALremote_uri"><code class="code"><span class="constructor">Irmin</span>.remote_uri</code></a> but it works for all
    backends.<br>
</div>

<pre><span class="keyword">module</span> <a href="Irmin.Sync.html">Sync</a> <code class="code">(</code><code class="code"><span class="constructor">S</span></code><code class="code"> : </code><code class="type"><a href="Irmin.S.html">S</a></code><code class="code">) </code>: <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.Sync.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
<code class="code"><span class="constructor">Sync</span></code> provides functions to synchronization an Irmin store with
    local and remote Irmin stores.
</div>

<pre><span class="keyword">module type</span> <a href="Irmin.VIEW.html">VIEW</a> = <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.VIEW.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
<code class="code"><span class="constructor">View</span></code> provides an in-memory partial mirror of the store, with
    lazy reads and delayed write.
</div>

<pre><span class="keyword">module</span> <a href="Irmin.View.html">View</a> <code class="code">(</code><code class="code"><span class="constructor">S</span></code><code class="code"> : </code><code class="type"><a href="Irmin.S.html">S</a></code><code class="code">) </code>: <code class="type"><a href="Irmin.VIEW.html">VIEW</a></code><code class="type">  with type db = S.t
                          and type key = S.Key.t
                          and type value = S.Val.t</code></pre><div class="info">
Create views.
</div>

<pre><span class="keyword">module</span> <a href="Irmin.Snapshot.html">Snapshot</a> <code class="code">(</code><code class="code"><span class="constructor">S</span></code><code class="code"> : </code><code class="type"><a href="Irmin.S.html">S</a></code><code class="code">) </code>: <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.Snapshot.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
<code class="code"><span class="constructor">Snapshot</span></code> provides read-only, space-efficient, checkpoints of a
    store.
</div>

<pre><span class="keyword">module</span> <a href="Irmin.Dot.html">Dot</a> <code class="code">(</code><code class="code"><span class="constructor">S</span></code><code class="code"> : </code><code class="type"><a href="Irmin.S.html">S</a></code><code class="code">) </code>: <code class="code"><span class="keyword">sig</span></code> <a href="Irmin.Dot.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
<code class="code"><span class="constructor">Dot</span></code> provides functions to export a store to the Graphviz `dot`
    format.
</div>
<br>
<h1 id="backend">Backends</h1><br>
<br>
API to create new Irmin backends. A backend is an implementation
    exposing either a concrete implementation of <a href="Irmin.S.html"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">S</span></code></a> or a functor
    providing <a href="Irmin.S.html"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">S</span></code></a> once applied.
<p>

    There are two ways to create a concrete <a href="Irmin.S.html"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">S</span></code></a> implementation:
<p>

    <ul>
<li><a href="Irmin.Make.html"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">Make</span></code></a> creates a store where all the objects are stored in the
    same store, using the same internal keys format and a custom binary
    format based on <a href="https://github.com/janestreet/bin_prot">bin_prot</a>,
    with no native synchronization primitives: it is usually what is
    needed to quickly create a new backend.</li>
<li><a href="Irmin.Make_ext.html"><code class="code"><span class="constructor">Irmin</span>.<span class="constructor">Make_ext</span></code></a> creates a store with a <em>deep</em> embedding of each
    of the internal stores into separate store, with a total control over
    the binary format and using the native synchronization protocols
    when available. This is mainly used by the Git backend, but could
    be used for other similar backends as well in the future.</li>
</ul>
<br>

<pre><span class="keyword">module type</span> <a href="Irmin.AO_MAKER.html">AO_MAKER</a> = <code class="code">(</code><code class="code"><span class="constructor">K</span></code><code class="code"> : </code><code class="type"><a href="Irmin.Hash.S.html">Hash.S</a></code><code class="code">) </code><code class="code">(</code><code class="code"><span class="constructor">V</span></code><code class="code"> : </code><code class="type">Tc.S0</code><code class="code">) </code><code class="type"><a href="Irmin.AO.html">AO</a></code><code class="type">  with type key = K.t and type value = V.t</code></pre><div class="info">
<code class="code"><span class="constructor">AO_MAKER</span></code> is the signature exposed by any backend providing
    append-only stores.
</div>

<pre><span class="keyword">module type</span> <a href="Irmin.RW_MAKER.html">RW_MAKER</a> = <code class="code">(</code><code class="code"><span class="constructor">K</span></code><code class="code"> : </code><code class="type"><a href="Irmin.Hum.S.html">Hum.S</a></code><code class="code">) </code><code class="code">(</code><code class="code"><span class="constructor">V</span></code><code class="code"> : </code><code class="type"><a href="Irmin.Hash.S.html">Hash.S</a></code><code class="code">) </code><code class="type"><a href="Irmin.RW.html">RW</a></code><code class="type">  with type key = K.t and type value = V.t</code></pre><div class="info">
<code class="code"><span class="constructor">RW_MAKER</span></code> is the signature exposed by any backend providing
    read-write stores.
</div>

<pre><span class="keyword">module</span> <a href="Irmin.Make.html">Make</a> <code class="code">(</code><code class="code"><span class="constructor">AO</span></code><code class="code"> : </code><code class="type"><a href="Irmin.AO_MAKER.html">AO_MAKER</a></code><code class="code">) </code> <code class="code">(</code><code class="code"><span class="constructor">RW</span></code><code class="code"> : </code><code class="type"><a href="Irmin.RW_MAKER.html">RW_MAKER</a></code><code class="code">) </code>: <code class="type"><a href="Irmin.S_MAKER.html">S_MAKER</a></code><code class="type"> </code></pre><div class="info">
Simple store creator.
</div>

<pre><span class="keyword">module</span> <a href="Irmin.Make_ext.html">Make_ext</a> <code class="code">(</code><code class="code"><span class="constructor">P</span></code><code class="code"> : </code><code class="type"><a href="Irmin.Private.S.html">Private.S</a></code><code class="code">) </code>: <code class="type"><a href="Irmin.S.html">S</a></code><code class="type"> 
  with type key = P.Contents.Path.t
   and type value = P.Contents.value
   and type tag = P.Tag.key
   and type head = P.Tag.value
   and type Key.step = P.Contents.Path.step</code></pre><div class="info">
Advanced store creator.
</div>
</body></html>
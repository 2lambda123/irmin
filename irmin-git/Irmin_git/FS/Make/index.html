<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (irmin-git.Irmin_git.FS.Make)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../../index.html">irmin-git</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Irmin_git.FS.Make</span></h1></header><h3 class="heading">Parameters</h3><div><div class="spec argument" id="argument-6-B"><a href="#argument-6-B" class="anchor"></a><div class="def argument"><code><a href="argument-6-B/index.html">B</a> : <a href="../../../../irmin/Irmin/Branch/index.html#module-type-S">Irmin.Branch.S</a></code></div><div class="doc"></div></div><div class="spec argument" id="argument-5-P"><a href="#argument-5-P" class="anchor"></a><div class="def argument"><code><a href="argument-5-P/index.html">P</a> : <a href="../../../../irmin/Irmin/Path/index.html#module-type-S">Irmin.Path.S</a></code></div><div class="doc"></div></div><div class="spec argument" id="argument-4-C"><a href="#argument-4-C" class="anchor"></a><div class="def argument"><code><a href="argument-4-C/index.html">C</a> : <a href="../../../../irmin/Irmin/Contents/index.html#module-type-S">Irmin.Contents.S</a></code></div><div class="doc"></div></div><div class="spec argument" id="argument-3-FS"><a href="#argument-3-FS" class="anchor"></a><div class="def argument"><code>FS : Git.FS.IO</code></div><div class="doc"></div></div><div class="spec argument" id="argument-2-I"><a href="#argument-2-I" class="anchor"></a><div class="def argument"><code>I : Git.Inflate.S</code></div><div class="doc"></div></div><div class="spec argument" id="argument-1-IO"><a href="#argument-1-IO" class="anchor"></a><div class="def argument"><code><a href="argument-1-IO/index.html">IO</a> : <a href="../../index.html#module-type-IO">IO</a></code></div><div class="doc"></div></div></div><h3 class="heading">Signature</h3><p>The Git backed specialized a few types:</p><ul><li>the allowed metdata are <a href="Metadata/index.html#type-t">Metadata.t</a>.</li><li>the hash algorithm is SHA1.</li></ul><p>.</p><div class="spec include"><div class="doc"></div><details open="open"><summary><span class="def"><code><span class="keyword">include </span><a href="../../../../irmin/Irmin/index.html#module-type-S">Irmin.S</a><span class="keyword"> with </span><span class="keyword">type </span><a href="../../../../irmin/Irmin/module-type-S/index.html#type-metadata">metadata</a><span class="keyword"> = </span><a href="../../Metadata/index.html#type-t">Metadata.t</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../irmin/Irmin/module-type-S/Commit/Hash/index.html">Commit.Hash</a> = <a href="../../../../irmin/Irmin/Hash/index.html#module-SHA1">Irmin.Hash.SHA1</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../irmin/Irmin/module-type-S/Contents/Hash/index.html">Contents.Hash</a> = <a href="../../../../irmin/Irmin/Hash/index.html#module-SHA1">Irmin.Hash.SHA1</a><span class="keyword"> and </span><span class="keyword">module </span><a href="../../../../irmin/Irmin/module-type-S/Tree/Hash/index.html">Tree.Hash</a> = <a href="../../../../irmin/Irmin/Hash/index.html#module-SHA1">Irmin.Hash.SHA1</a></code></span></summary><h2>Irmin stores</h2><p>Irmin stores are tree-like read-write stores with
extended capabilities. They allow an application (or a
collection of applications) to work with multiple local states,
which can be forked and merged programmatically, without having
to rely on a global state. In a way very similar to version
control systems, Irmin local states are called <i>branches</i>.</p><p>There are two kinds of store in Irmin: the ones based on
<span class="xref-unresolved" title="unresolved reference to &quot;persistent&quot;">persistent</span> named branches and the ones based
<span class="xref-unresolved" title="unresolved reference to &quot;temporary&quot;">temporary</span> detached heads. These exist relative to a
local, larger (and shared) store, and have some (shared)
contents. This is exactly the same as usual version control
systems, that the informed user can see as an implicit purely
functional data-structure.</p><div class="spec type" id="type-repo"><a href="#type-repo" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>repo</code><code></code><code></code></div><div class="doc"><p>The type for Irmin repositories.</p></div></div><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"><p>The type for Irmin stores.</p></div></div><div class="spec type" id="type-step"><a href="#type-step" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>step</code><code></code><code></code></div><div class="doc"><p>The type for <a href="index.html#type-key">key</a> steps.</p></div></div><div class="spec type" id="type-key"><a href="#type-key" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>key</code><code></code><code></code></div><div class="doc"><p>The type for store keys. A key is a sequence of <a href="index.html#type-step">step</a>s.</p></div></div><div class="spec type" id="type-metadata"><a href="#type-metadata" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>metadata</code><code><span class="keyword"> = </span><a href="../../Metadata/index.html#type-t">Metadata.t</a></code><code></code></div><div class="doc"><p>The type for store metadata.</p></div></div><div class="spec type" id="type-contents"><a href="#type-contents" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>contents</code><code></code><code></code></div><div class="doc"><p>The type for store contents.</p></div></div><div class="spec type" id="type-node"><a href="#type-node" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>node</code><code></code><code></code></div><div class="doc"><p>The type for store nodes.</p></div></div><div class="spec type" id="type-tree"><a href="#type-tree" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>tree</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-tree.Node" class="anchored"><td class="def constructor"><a href="#type-tree.Node" class="anchor"></a><code><span class="keyword">| </span></code><code>`Node<span class="keyword"> of </span><a href="index.html#type-node">node</a></code></td></tr><tr id="type-tree.Contents" class="anchored"><td class="def constructor"><a href="#type-tree.Contents" class="anchor"></a><code><span class="keyword">| </span></code><code>`Contents<span class="keyword"> of </span><a href="index.html#type-contents">contents</a><span class="keyword"> * </span><a href="index.html#type-metadata">metadata</a></code></td></tr></table><code> ]</code><code></code></div><div class="doc"><p>The type for store trees.</p></div></div><div class="spec type" id="type-commit"><a href="#type-commit" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>commit</code><code></code><code></code></div><div class="doc"><p>Type for commit identifiers. Similar to Git's commit SHA1s.</p></div></div><div class="spec type" id="type-branch"><a href="#type-branch" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>branch</code><code></code><code></code></div><div class="doc"><p>Type for persistent branch names. Branches usually share a
common global namespace and it's the user's responsibility to
avoid name clashes.</p></div></div><div class="spec type" id="type-slice"><a href="#type-slice" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>slice</code><code></code><code></code></div><div class="doc"><p>Type for store slices.</p></div></div><div class="spec type" id="type-lca_error"><a href="#type-lca_error" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>lca_error</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-lca_error.Max_depth_reached" class="anchored"><td class="def constructor"><a href="#type-lca_error.Max_depth_reached" class="anchor"></a><code><span class="keyword">| </span></code><code>`Max_depth_reached</code></td></tr><tr id="type-lca_error.Too_many_lcas" class="anchored"><td class="def constructor"><a href="#type-lca_error.Too_many_lcas" class="anchor"></a><code><span class="keyword">| </span></code><code>`Too_many_lcas</code></td></tr></table><code> ]</code><code></code></div><div class="doc"><p>The type for errors associated with functions computing least
common ancestors</p></div></div><div class="spec type" id="type-ff_error"><a href="#type-ff_error" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>ff_error</code><span class="keyword"> = </span><code>[ </code><table class="variant"><tr id="type-ff_error.No_change" class="anchored"><td class="def constructor"><a href="#type-ff_error.No_change" class="anchor"></a><code><span class="keyword">| </span></code><code>`No_change</code></td></tr><tr id="type-ff_error.Rejected" class="anchored"><td class="def constructor"><a href="#type-ff_error.Rejected" class="anchor"></a><code><span class="keyword">| </span></code><code>`Rejected</code></td></tr><tr id="type-ff_error.lca_error" class="anchored"><td class="def type"><a href="#type-ff_error.lca_error" class="anchor"></a><code><span class="keyword">| </span></code><code><a href="index.html#type-lca_error">lca_error</a></code></td></tr></table><code> ]</code><code></code></div><div class="doc"><p>The type for errors for fast_forward.</p></div></div><div class="spec module" id="module-Repo"><a href="#module-Repo" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Repo/index.html">Repo</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Repositories.</p></div></div><div class="spec val" id="val-empty"><a href="#val-empty" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>empty : <a href="index.html#type-repo">repo</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> Lwt.t</code></div><div class="doc"><p><code class="code">empty repo</code> is a temporary, empty store. Becomes a normal
temporary store after the first update.</p></div></div><div class="spec val" id="val-master"><a href="#val-master" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>master : <a href="index.html#type-repo">repo</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> Lwt.t</code></div><div class="doc"><p><code class="code">master repo</code> is a persistent store based on <code class="code">r</code>'s master
branch. This operation is cheap, can be repeated multiple
times.</p></div></div><div class="spec val" id="val-of_branch"><a href="#val-of_branch" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>of_branch : <a href="index.html#type-repo">repo</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-branch">branch</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> Lwt.t</code></div><div class="doc"><p><code class="code">of_branch r name</code> is a persistent store based on the branch
<code class="code">name</code>. Similar to <code class="code">master</code>, but use <code class="code">name</code> instead
<span class="xref-unresolved" title="unresolved reference to &quot;Branch.S.master&quot;"><span class="xref-unresolved" title="unresolved reference to &quot;Branch.S&quot;"><a href="index.html#module-Branch">Branch</a>.S</span>.master</span>.</p></div></div><div class="spec val" id="val-of_commit"><a href="#val-of_commit" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>of_commit : <a href="index.html#type-commit">commit</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> Lwt.t</code></div><div class="doc"><p><code class="code">of_commit c</code> is a temporary store, based on the commit <code class="code">c</code>.</p><p>Temporary stores do not have stable names: instead they can be
addressed using the hash of the current commit. Temporary stores
are similar to Git's detached heads. In a temporary store, all
the operations are performed relative to the current head and
update operations can modify the current head: the current
stores's head will automatically become the new head obtained
after performing the update.</p></div></div><div class="spec val" id="val-repo"><a href="#val-repo" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>repo : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-repo">repo</a></code></div><div class="doc"><p><code class="code">repo t</code> is the repository containing <code class="code">t</code>.</p></div></div><div class="spec val" id="val-tree"><a href="#val-tree" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>tree : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-tree">tree</a> Lwt.t</code></div><div class="doc"><p><code class="code">tree t</code> is <code class="code">t</code>'s current tree. Contents is not allowed at the
root of the tree.</p></div></div><div class="spec module" id="module-Status"><a href="#module-Status" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Status/index.html">Status</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p><code class="code">Status</code> provides base functions for store statuses.</p></div></div><div class="spec val" id="val-status"><a href="#val-status" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>status : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="Status/index.html#type-t">Status.t</a></code></div><div class="doc"><p><code class="code">status t</code> is <code class="code">t</code>'s status. It can either be a branch, a commit
or empty.</p></div></div><div class="spec module" id="module-Head"><a href="#module-Head" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Head/index.html">Head</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Managing the store's heads.</p></div></div><div class="spec module" id="module-Commit"><a href="#module-Commit" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Commit/index.html">Commit</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span><span class="keyword"> with </span><span class="keyword">module </span><a href="Commit/Hash/index.html">Hash</a> = <a href="../../../../irmin/Irmin/Hash/index.html#module-SHA1">Irmin.Hash.SHA1</a></code></div><div class="doc"><p><code class="code">Commit</code> defines immutable objects to describe store updates.</p></div></div><p>Managing store's trees.</p><div class="spec module" id="module-Tree"><a href="#module-Tree" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Tree/index.html">Tree</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span><span class="keyword"> with </span><span class="keyword">module </span><a href="Tree/Hash/index.html">Hash</a> = <a href="../../../../irmin/Irmin/Hash/index.html#module-SHA1">Irmin.Hash.SHA1</a></code></div><div class="doc"></div></div><div class="spec module" id="module-Contents"><a href="#module-Contents" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Contents/index.html">Contents</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span><span class="keyword"> with </span><span class="keyword">module </span><a href="Contents/Hash/index.html">Hash</a> = <a href="../../../../irmin/Irmin/Hash/index.html#module-SHA1">Irmin.Hash.SHA1</a></code></div><div class="doc"><p><code class="code">Contents</code> provides base functions for the store's contents.</p></div></div><h2>Reads</h2><div class="spec val" id="val-kind"><a href="#val-kind" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>kind : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> [ `Contents | `Node ] option Lwt.t</code></div><div class="doc"><p><code class="code">kind</code> is <a href="Tree/index.html#val-kind">Tree.kind</a> applied to <code class="code">t</code>'s root tree.</p></div></div><div class="spec val" id="val-list"><a href="#val-list" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>list : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-step">step</a><span class="keyword"> * </span>[ `Contents | `Node ]) list Lwt.t</code></div><div class="doc"><p><code class="code">list t</code> is <a href="Tree/index.html#val-list">Tree.list</a> applied to <code class="code">t</code>'s root tree.</p></div></div><div class="spec val" id="val-mem"><a href="#val-mem" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>mem : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> bool Lwt.t</code></div><div class="doc"><p><code class="code">mem t</code> is <a href="Tree/index.html#val-mem">Tree.mem</a> applied to <code class="code">t</code>'s root tree.</p></div></div><div class="spec val" id="val-mem_tree"><a href="#val-mem_tree" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>mem_tree : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> bool Lwt.t</code></div><div class="doc"><p><code class="code">mem_tree t</code> is <a href="Tree/index.html#val-mem_tree">Tree.mem_tree</a> applied to <code class="code">t</code>'s root tree.</p></div></div><div class="spec val" id="val-find_all"><a href="#val-find_all" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>find_all : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-contents">contents</a><span class="keyword"> * </span><a href="index.html#type-metadata">metadata</a>) option Lwt.t</code></div><div class="doc"><p><code class="code">find_all t</code> is <a href="Tree/index.html#val-find_all">Tree.find_all</a> applied to <code class="code">t</code>'s root tree.</p></div></div><div class="spec val" id="val-find"><a href="#val-find" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>find : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-contents">contents</a> option Lwt.t</code></div><div class="doc"><p><code class="code">find t</code> is <a href="Tree/index.html#val-find">Tree.find</a> applied to <code class="code">t</code>'s root tree.</p></div></div><div class="spec val" id="val-get_all"><a href="#val-get_all" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>get_all : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-contents">contents</a><span class="keyword"> * </span><a href="index.html#type-metadata">metadata</a>) Lwt.t</code></div><div class="doc"><p><code class="code">get_all t</code> is <a href="Tree/index.html#val-get_all">Tree.get_all</a> applied on <code class="code">t</code>'s root tree.</p></div></div><div class="spec val" id="val-get"><a href="#val-get" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>get : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-contents">contents</a> Lwt.t</code></div><div class="doc"><p><code class="code">get t</code> is <a href="Tree/index.html#val-get">Tree.get</a> applied to <code class="code">t</code>'s root tree.</p></div></div><div class="spec val" id="val-find_tree"><a href="#val-find_tree" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>find_tree : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-tree">tree</a> option Lwt.t</code></div><div class="doc"><p><code class="code">find_tree t</code> is <a href="Tree/index.html#val-find_tree">Tree.find_tree</a> applied to <code class="code">t</code>'s root
tree.</p></div></div><div class="spec val" id="val-get_tree"><a href="#val-get_tree" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>get_tree : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-tree">tree</a> Lwt.t</code></div><div class="doc"><p><code class="code">get_tree t k</code> is <a href="Tree/index.html#val-get_tree">Tree.get_tree</a> applied to <code class="code">t</code>'s root
tree.</p></div></div><h2>Transactions</h2><div class="spec type" id="type-transaction"><a href="#type-transaction" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>'a transaction</code><code><span class="keyword"> = </span>?&#8288;allow_empty:bool <span class="keyword">&#8209;&gt;</span> ?&#8288;strategy:[ `Set | `Test_and_set | `Merge ] <span class="keyword">&#8209;&gt;</span> ?&#8288;max_depth:int <span class="keyword">&#8209;&gt;</span> ?&#8288;n:int <span class="keyword">&#8209;&gt;</span> info:<a href="../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> unit Lwt.t</code><code></code></div><div class="doc"><p>The type for transactions.</p></div></div><div class="spec val" id="val-with_tree"><a href="#val-with_tree" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>with_tree : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-tree">tree</a> option <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-tree">tree</a> option Lwt.t) <a href="index.html#type-transaction">transaction</a></code></div><div class="doc"><p><code class="code">with_tree t k ~info f</code> replaces <i>atomically</i> the subtree <code class="code">v</code>
under <code class="code">k</code> in the store <code class="code">t</code> by the contents of the tree <code class="code">f v</code>,
using the commit info <code class="code">info ()</code>.</p><p>If <code class="code">v = f v</code> and <code class="code">allow_empty</code> is unset (default) then, the
operation is a no-op.</p><p>If <code class="code">v != f v</code> and no other changes happen concurrently, <code class="code">f v</code>
becomes the new subtree under <code class="code">k</code>. If other changes happen
concurrently to that operations, the semantics depend on the
value of <code class="code">strategy</code>:</p><ul><li>if <code class="code">strategy = `Set</code>, the <em>last write wins</em>.</li><li>if <code class="code">strategy = `Test_and_set</code> (default), the transaction is
restarted.</li><li>if <code class="code">strategy = `Merge</code>, concurrent changes are merged with <code class="code">f
         v</code>. If the merge has a conflict, the transaction is
restarted.</li></ul><p><b>Note:</b> Irmin transactions provides
<a href="https://en.wikipedia.org/wiki/Snapshot_isolation">snapshot
isolation</a> guarantees: reads and writes are isolated in every
transaction, but only write conflicts are visible on commit.</p></div></div><div class="spec val" id="val-set"><a href="#val-set" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>set : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;metadata:<a href="index.html#type-metadata">metadata</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-contents">contents</a> <a href="index.html#type-transaction">transaction</a></code></div><div class="doc"><p><code class="code">set t k ~info v</code> is <code class="code">with_tree t k ~info (fun tree -&gt; Tree.add
      tree [] v)</code>.</p></div></div><div class="spec val" id="val-set_tree"><a href="#val-set_tree" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>set_tree : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-tree">tree</a> <a href="index.html#type-transaction">transaction</a></code></div><div class="doc"><p><code class="code">set_tree t k ~info v</code> is <code class="code">with_tree t k ~info (fun tree -&gt;
      Tree.add_tree tree [] v)</code>.</p></div></div><div class="spec val" id="val-remove"><a href="#val-remove" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>remove : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <a href="index.html#type-transaction">transaction</a></code></div><div class="doc"><p><code class="code">remove t i k</code> is <code class="code">with_tree t i k (fun tree -&gt; Tree.remove tree
      [])</code>.</p></div></div><h2>Clones</h2><div class="spec val" id="val-clone"><a href="#val-clone" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>clone : src:<a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> dst:<a href="index.html#type-branch">branch</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> Lwt.t</code></div><div class="doc"><p><code class="code">clone ~src ~dst</code> makes <code class="code">dst</code> points to <code class="code">Head.get src</code>. <code class="code">dst</code> is
created if needed. Remove the current contents en <code class="code">dst</code> if <code class="code">src</code>
is <a href="index.html#val-empty">empty</a>.</p></div></div><h2>Watches</h2><div class="spec type" id="type-watch"><a href="#type-watch" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>watch</code><code></code><code></code></div><div class="doc"><p>The type for store watches.</p></div></div><div class="spec val" id="val-watch"><a href="#val-watch" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>watch : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;init:<a href="index.html#type-commit">commit</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-commit">commit</a> <a href="../../../../irmin/Irmin/index.html#type-diff">Irmin.diff</a> <span class="keyword">&#8209;&gt;</span> unit Lwt.t) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-watch">watch</a> Lwt.t</code></div><div class="doc"><p><code class="code">watch t f</code> calls <code class="code">f</code> every time the contents of <code class="code">t</code>'s head is
updated.</p><p><b>Note:</b> even if <code class="code">f</code> might skip some head updates, it will
never be called concurrently: all consecutive calls to <code class="code">f</code> are
done in sequence, so we ensure that the previous one ended
before calling the next one.</p></div></div><div class="spec val" id="val-watch_key"><a href="#val-watch_key" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>watch_key : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-key">key</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;init:<a href="index.html#type-commit">commit</a> <span class="keyword">&#8209;&gt;</span> ((<a href="index.html#type-commit">commit</a><span class="keyword"> * </span><a href="index.html#type-tree">tree</a>) <a href="../../../../irmin/Irmin/index.html#type-diff">Irmin.diff</a> <span class="keyword">&#8209;&gt;</span> unit Lwt.t) <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-watch">watch</a> Lwt.t</code></div><div class="doc"><p><code class="code">watch_key t key f</code> calls <code class="code">f</code> every time the <code class="code">key</code>'s value is
added, removed or updated. If the current branch is deleted,
no signal is sent to the watcher.</p></div></div><div class="spec val" id="val-unwatch"><a href="#val-unwatch" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>unwatch : <a href="index.html#type-watch">watch</a> <span class="keyword">&#8209;&gt;</span> unit Lwt.t</code></div><div class="doc"><p><code class="code">unwatch w</code> disable <code class="code">w</code>. Return once the <code class="code">w</code> is fully
disabled.</p></div></div><h2>Merges and Common Ancestors.</h2><div class="spec type" id="type-merge"><a href="#type-merge" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>'a merge</code><code><span class="keyword"> = </span>info:<a href="../../../../irmin/Irmin/Info/index.html#type-f">Irmin.Info.f</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;max_depth:int <span class="keyword">&#8209;&gt;</span> ?&#8288;n:int <span class="keyword">&#8209;&gt;</span> <span class="type-var">'a</span> <span class="keyword">&#8209;&gt;</span> (unit, <a href="../../../../irmin/Irmin/Merge/index.html#type-conflict">Irmin.Merge.conflict</a>) Result.result Lwt.t</code><code></code></div><div class="doc"><p>The type for merge functions.</p></div></div><div class="spec val" id="val-merge"><a href="#val-merge" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>merge : into:<a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <a href="index.html#type-merge">merge</a></code></div><div class="doc"><p><code class="code">merge ~into i t</code> merges <code class="code">t</code>'s current branch into <code class="code">x</code>'s current
branch using the info <code class="code">i</code>. After that operation, the two stores
are still independent. Similar to <code class="code">git merge &lt;branch&gt;</code>.</p></div></div><div class="spec val" id="val-merge_with_branch"><a href="#val-merge_with_branch" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>merge_with_branch : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-branch">branch</a> <a href="index.html#type-merge">merge</a></code></div><div class="doc"><p>Same as <a href="index.html#type-merge">merge</a> but with a branch ID.</p></div></div><div class="spec val" id="val-merge_with_commit"><a href="#val-merge_with_commit" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>merge_with_commit : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-commit">commit</a> <a href="index.html#type-merge">merge</a></code></div><div class="doc"><p>Same as <a href="index.html#type-merge">merge</a> but with a commit ID.</p></div></div><div class="spec val" id="val-lcas"><a href="#val-lcas" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>lcas : ?&#8288;max_depth:int <span class="keyword">&#8209;&gt;</span> ?&#8288;n:int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-commit">commit</a> list, <a href="index.html#type-lca_error">lca_error</a>) Result.result Lwt.t</code></div><div class="doc"><p><code class="code">lca ?max_depth ?n msg t1 t2</code> returns the collection of least
common ancestors between the heads of <code class="code">t1</code> and <code class="code">t2</code> branches.</p><ul><li><code class="code">max_depth</code> is the maximum depth of the exploration (default
is <code class="code">max_int</code>). Return <code class="code">Error `Max_depth_reached</code> if this depth
is exceeded.</li><li><code class="code">n</code> is the maximum expected number of lcas. Stop the
exploration as soon as <code class="code">n</code> lcas are found. Return <code class="code">Error
      `Too_many_lcas</code> if more <code class="code">lcas</code> are found.</li></ul></div></div><div class="spec val" id="val-lcas_with_branch"><a href="#val-lcas_with_branch" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>lcas_with_branch : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;max_depth:int <span class="keyword">&#8209;&gt;</span> ?&#8288;n:int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-branch">branch</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-commit">commit</a> list, <a href="index.html#type-lca_error">lca_error</a>) Result.result Lwt.t</code></div><div class="doc"><p>Same as <a href="index.html#val-lcas">lcas</a> but takes a branch ID as argument.</p></div></div><div class="spec val" id="val-lcas_with_commit"><a href="#val-lcas_with_commit" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>lcas_with_commit : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;max_depth:int <span class="keyword">&#8209;&gt;</span> ?&#8288;n:int <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-commit">commit</a> <span class="keyword">&#8209;&gt;</span> (<a href="index.html#type-commit">commit</a> list, <a href="index.html#type-lca_error">lca_error</a>) Result.result Lwt.t</code></div><div class="doc"><p>Same as <a href="index.html#val-lcas">lcas</a> but takes a commit ID as argument.</p></div></div><h2>History</h2><div class="spec module" id="module-History"><a href="#module-History" class="anchor"></a><div class="def module"><code><span class="keyword">module </span>History : Graph.Sig.P<span class="keyword"> with </span><span class="keyword">type </span><a href="index.html#module-History">History</a>.V.t<span class="keyword"> = </span><a href="index.html#type-commit">commit</a></code></div><div class="doc"><p>An history is a DAG of heads.</p></div></div><div class="spec val" id="val-history"><a href="#val-history" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>history : ?&#8288;depth:int <span class="keyword">&#8209;&gt;</span> ?&#8288;min:<a href="index.html#type-commit">commit</a> list <span class="keyword">&#8209;&gt;</span> ?&#8288;max:<a href="index.html#type-commit">commit</a> list <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#module-History">History</a>.t Lwt.t</code></div><div class="doc"><p><code class="code">history ?depth ?min ?max t</code> is a view of the history of the
store <code class="code">t</code>, of depth at most <code class="code">depth</code>, starting from the <code class="code">max</code>
(or from the <code class="code">t</code>'s head if the list of heads is empty) and
stopping at <code class="code">min</code> if specified.</p></div></div><div class="spec module" id="module-Branch"><a href="#module-Branch" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Branch/index.html">Branch</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Manipulate branches.</p></div></div><div class="spec module" id="module-Key"><a href="#module-Key" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Key/index.html">Key</a> : <a href="../../../../irmin/Irmin/Path/index.html#module-type-S">Irmin.Path.S</a><span class="keyword"> with </span><span class="keyword">type </span><a href="../../../../irmin/Irmin/Path/module-type-S/index.html#type-t">t</a><span class="keyword"> = </span><a href="index.html#type-key">key</a><span class="keyword"> and </span><span class="keyword">type </span><a href="../../../../irmin/Irmin/Path/module-type-S/index.html#type-step">step</a><span class="keyword"> = </span><a href="index.html#type-step">step</a></code></div><div class="doc"><p><code class="code">Key</code> provides base functions for the stores's paths.</p></div></div><div class="spec module" id="module-Metadata"><a href="#module-Metadata" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Metadata/index.html">Metadata</a> : <a href="../../../../irmin/Irmin/Metadata/index.html#module-type-S">Irmin.Metadata.S</a><span class="keyword"> with </span><span class="keyword">type </span><a href="../../../../irmin/Irmin/Metadata/module-type-S/index.html#type-t">t</a><span class="keyword"> = </span><a href="index.html#type-metadata">metadata</a></code></div><div class="doc"><p><code class="code">Metadata</code> provides base functions for node metadata.</p></div></div><h2>Value Types</h2><div class="spec val" id="val-step_t"><a href="#val-step_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>step_t : <a href="index.html#type-step">step</a> <a href="../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></code></div><div class="doc"><p><code class="code">step_t</code> is the value type for <a href="index.html#type-step">step</a>.</p></div></div><div class="spec val" id="val-key_t"><a href="#val-key_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>key_t : <a href="index.html#type-key">key</a> <a href="../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></code></div><div class="doc"><p><code class="code">key_t</code> is the value type for <a href="index.html#type-key">key</a>.</p></div></div><div class="spec val" id="val-metadata_t"><a href="#val-metadata_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>metadata_t : <a href="index.html#type-metadata">metadata</a> <a href="../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></code></div><div class="doc"><p><code class="code">metadata_t</code> is the value type for <a href="index.html#type-metadata">metadata</a>.</p></div></div><div class="spec val" id="val-contents_t"><a href="#val-contents_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>contents_t : <a href="index.html#type-contents">contents</a> <a href="../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></code></div><div class="doc"><p><code class="code">contents_t</code> is the value type for <a href="index.html#type-contents">contents</a>.</p></div></div><div class="spec val" id="val-node_t"><a href="#val-node_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>node_t : <a href="index.html#type-node">node</a> <a href="../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></code></div><div class="doc"><p><code class="code">node_t</code> is the value type for <a href="index.html#type-node">node</a>.</p></div></div><div class="spec val" id="val-tree_t"><a href="#val-tree_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>tree_t : <a href="index.html#type-tree">tree</a> <a href="../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></code></div><div class="doc"><p><code class="code">tree_t</code> is the value type for <a href="index.html#type-tree">tree</a>.</p></div></div><div class="spec val" id="val-commit_t"><a href="#val-commit_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>commit_t : <a href="index.html#type-repo">repo</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-commit">commit</a> <a href="../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></code></div><div class="doc"><p><code class="code">commit_t r</code> is the value type for <a href="index.html#type-commit">commit</a>.</p></div></div><div class="spec val" id="val-branch_t"><a href="#val-branch_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>branch_t : <a href="index.html#type-branch">branch</a> <a href="../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></code></div><div class="doc"><p><code class="code">branch_t</code> is the value type for <a href="index.html#type-branch">branch</a>.</p></div></div><div class="spec val" id="val-slice_t"><a href="#val-slice_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>slice_t : <a href="index.html#type-slice">slice</a> <a href="../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></code></div><div class="doc"><p><code class="code">slice_t</code> is the value type for <a href="index.html#type-slice">slice</a>.</p></div></div><div class="spec val" id="val-kind_t"><a href="#val-kind_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>kind_t : [ `Node | `Contents ] <a href="../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></code></div><div class="doc"><p><code class="code">kind_t</code> is the value type for values returned by <a href="index.html#val-kind">kind</a>.</p></div></div><div class="spec val" id="val-lca_error_t"><a href="#val-lca_error_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>lca_error_t : <a href="index.html#type-lca_error">lca_error</a> <a href="../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></code></div><div class="doc"><p><code class="code">lca_error_t</code> is the value type for <a href="index.html#type-lca_error">lca_error</a>.</p></div></div><div class="spec val" id="val-ff_error_t"><a href="#val-ff_error_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>ff_error_t : <a href="index.html#type-ff_error">ff_error</a> <a href="../../../../irmin/Irmin/Type/index.html#type-t">Irmin.Type.t</a></code></div><div class="doc"><p><code class="code">ff_error_t</code> is the value type for <a href="index.html#type-ff_error">ff_error</a>.</p></div></div><div class="spec module" id="module-Private"><a href="#module-Private" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Private/index.html">Private</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Private functions, which might be used by the backends.</p></div></div></details></div><div class="spec module" id="module-Git"><a href="#module-Git" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Git/index.html">Git</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><h2>Access to the Git objects</h2></div></div><div class="spec module" id="module-Git_mem"><a href="#module-Git_mem" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="Git_mem/index.html">Git_mem</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="doc"><p>Only valid for in-memory Git stores.</p></div></div></body></html>
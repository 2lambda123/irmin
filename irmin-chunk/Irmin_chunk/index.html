<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Irmin_chunk (irmin-chunk.Irmin_chunk)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../index.html">irmin-chunk</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Irmin_chunk</span></h1></header><p>This package provides an Irmin backend to cut raw contents into blocks
of the same size, while preserving the keys used in the store. It can
be used to optimize space usage when dealing with large files or as a
an intermediate layer for a raw block device backend.</p><p># Install</p><p>Use opam:</p><p>```shell
opam install irmin-chunk
```</p><p># Use</p><p>```ocaml
(* Build an Irmin store, where blobs are cut into chunks of same size *)
module AO = Irmin_chunk.AO_stable(Irmin_mem.Link)(Irmin_mem.AO)
module Store = Irmin.Make(AO)(Irmin_mem.RW)
```</p><p>Managing Chunks.</p><p>This module exposes functors to store raw contents into
append-only stores as chunks of same size. It exposes the
<a href="AO/index.html">AO</a> functor which split the raw contents into <code class="code">Data</code> blocks,
addressed by <code class="code">Node</code> blocks. That's the usual rope-like
representation of strings, but chunk trees are always build as
perfectly well-balanced and blocks are addressed by their hash (or
by the stable keys returned by the underlying store).</p><p>A chunk has the following structure:</p><pre>
     --------------------------
     | uint8_t type            |
     ---------------------------
     | uint16_t length         |
     ---------------------------
     | byte data[length]       |
     ---------------------------
</pre><p><code class="code">type</code> is either <code class="code">Data</code> (0) or <code class="code">Node</code> (1). If the chunk contains
data, <code class="code">length</code> is the payload length. Otherwise it is the number
of children that the node has.</p><p>It also exposes <a href="AO_stable/index.html">AO_stable</a> which -- as <a href="AO/index.html">AO</a> does
-- stores raw contents into chunks of same size. But it also
preserves the nice properpty that values are addressed by their
hash. instead of by the hash of the root chunk node as it is the
case for <a href="AO/index.html">AO</a>.</p><div class="spec val" id="val-chunk_size"><a href="#val-chunk_size" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>chunk_size : int <a href="../../irmin/Irmin/Private/Conf/index.html#type-key">Irmin.Private.Conf.key</a></code></div><div class="doc"><p><code class="code">chunk_size</code> is the configuration key to configure chunks'
size. By default, it is set to 4666, so that payload and metadata
can be stored in a 4K block.</p></div></div><div class="spec val" id="val-config"><a href="#val-config" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>config : ?&#8288;config:<a href="../../irmin/Irmin/index.html#type-config">Irmin.config</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;size:int <span class="keyword">&#8209;&gt;</span> ?&#8288;min_size:int <span class="keyword">&#8209;&gt;</span> unit <span class="keyword">&#8209;&gt;</span> <a href="../../irmin/Irmin/index.html#type-config">Irmin.config</a></code></div><div class="doc"><p><code class="code">config ?config ?size ?min_size ()</code> is the configuration value
extending the optional <code class="code">config</code> with bindings associating
<a href="index.html#val-chunk_size">chunk_size</a> to <code class="code">size</code>.</p><p>Fail with <code class="code">Invalid_argument</code> if <code class="code">size</code> is smaller than <code class="code">min_size</code>.
<code class="code">min_size</code> is, by default, set to 4000 (to avoid hash colision on
smaller size) but can be tweaked for testing purposes. <i>Notes:</i>
the smaller <code class="code">size</code> is, the bigger the risk of hash collisions, so
use reasonable values.</p></div></div><div class="spec module" id="module-AO"><a href="#module-AO" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="AO/index.html">AO</a> : <span class="keyword">functor</span> (<a href="AO/argument-1-S/index.html">S</a> : <a href="../../irmin/Irmin/index.html#module-type-AO_MAKER">Irmin.AO_MAKER</a>) -&gt; <a href="../../irmin/Irmin/index.html#module-type-AO_MAKER">Irmin.AO_MAKER</a></code></div><div class="doc"><p><code class="code">AO(X)</code> is an append-only store which store values cut into chunks
into the underlying store <code class="code">X</code>.</p></div></div><div class="spec module" id="module-AO_stable"><a href="#module-AO_stable" class="anchor"></a><div class="def module"><code><span class="keyword">module </span><a href="AO_stable/index.html">AO_stable</a> : <span class="keyword">functor</span> (<a href="AO_stable/argument-1-L/index.html">L</a> : <a href="../../irmin/Irmin/index.html#module-type-LINK_MAKER">Irmin.LINK_MAKER</a>) -&gt; <span class="keyword">functor</span> (<a href="AO_stable/argument-2-S/index.html">S</a> : <a href="../../irmin/Irmin/index.html#module-type-AO_MAKER">Irmin.AO_MAKER</a>) -&gt; <a href="../../irmin/Irmin/index.html#module-type-AO_MAKER">Irmin.AO_MAKER</a></code></div><div class="doc"><p><code class="code">AO_stable(L)(X)</code> is similar to <code class="code">AO(X)</code> but is ensures that the
return keys are similar as if they were stored directly in <code class="code">X</code>, so
that the fact that blobs are cut into chunks is an implementation
detail.</p></div></div></body></html>
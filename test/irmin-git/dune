(library
 (name test_git)
 (modules test_git)
 (libraries alcotest fmt fpath irmin irmin-test irmin.mem irmin-git git
   git-unix lwt lwt.unix)
 (preprocess
  (pps ppx_irmin)))

(executable
 (name test)
 (modules test)
 (libraries alcotest irmin irmin-test test_git))

; Temporary disable the tests on s390x because of
; https://github.com/ocaml/ocaml/issues/10857

(rule
 (alias runtest)
 (package irmin-git)
 (enabled_if
  (<> %{architecture} "s390x"))
 (action
  (run ./test.exe -q --color=always)))
